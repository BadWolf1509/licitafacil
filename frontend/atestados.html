<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LicitaFácil - Atestados</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/atestados.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <a href="dashboard.html" class="header-logo">LicitaFácil</a>
        <nav class="header-nav">
            <a href="dashboard.html">Dashboard</a>
            <a href="atestados.html" class="active">Atestados</a>
            <a href="analises.html">Análises</a>
            <a href="admin.html" id="adminLink" class="hidden">Admin</a>
            <button class="theme-toggle" onclick="toggleTheme()" title="Alternar tema">&#127763;</button>
            <button class="btn btn-outline btn-sm" onclick="logout()">Sair</button>
        </nav>
    </header>

    <div class="container">
        <div id="alertContainer"></div>

        <div id="processingJobs" class="mb-2"></div>

        <div class="d-flex justify-between align-center mb-3">
            <h1>Meus Atestados</h1>
            <div class="d-flex gap-2">
                <button class="btn btn-outline" onclick="abrirRelatorioGeral()" id="btnRelatorioGeral" style="display: none;">
                    Relatorio Geral
                </button>
                <button class="btn btn-primary" onclick="abrirModalAtestado()">+ Novo Atestado</button>
            </div>
        </div>

        <!-- Upload de arquivo -->
        <div class="upload-zone" id="uploadZone">
            <div class="upload-icon">&#128196;</div>
            <h3>Arraste um PDF ou imagem aqui</h3>
            <p class="text-muted">ou clique para selecionar um arquivo</p>
            <input type="file" id="fileInput" accept=".pdf,.png,.jpg,.jpeg">
        </div>

        <!-- Filtro de atestados -->
        <div class="filtro-atestados" id="filtroAtestadosContainer" style="display: none;">
            <input type="text"
                   id="filtroAtestadosInput"
                   class="form-input"
                   placeholder="Filtrar atestados por descricao, contratante..."
                   oninput="AtestadosModule.filtrarAtestados(this.value)">
            <span class="filtro-contador" id="atestadosFiltradosCount"></span>
        </div>

        <!-- Lista de atestados -->
        <div id="listaAtestados">
            <div class="card empty-state">
                <div class="empty-state-icon">&#128203;</div>
                <h3>Carregando atestados...</h3>
            </div>
        </div>
    </div>

    <!-- Modal de Resultado Consolidado (Individual) -->
    <div class="modal" id="modalResultado">
        <div class="modal-content modal-resultado">
            <div class="modal-header">
                <h2>Resultado Consolidado</h2>
                <button class="modal-close" onclick="fecharModal('modalResultado')">&times;</button>
            </div>
            <div id="resultadoContent">
                Carregando...
            </div>
        </div>
    </div>

    <!-- Modal de Relatório Geral (Todos os Atestados) -->
    <div class="modal" id="modalRelatorioGeral">
        <div class="modal-content modal-relatorio-geral">
            <div class="modal-header">
                <h2>Relatorio Consolidado - Todos os Atestados</h2>
                <button class="modal-close" onclick="fecharModal('modalRelatorioGeral')">&times;</button>
            </div>
            <div id="relatorioGeralContent">
                Carregando...
            </div>
        </div>
    </div>

    <!-- Modal de Detalhes do Serviço (Atestados que compõem) -->
    <div class="modal" id="modalDetalhesServico">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h2>Detalhes do Servico</h2>
                <button class="modal-close" onclick="fecharModal('modalDetalhesServico')">&times;</button>
            </div>
            <div id="detalhesServicoContent">
                Carregando...
            </div>
        </div>
    </div>

    <!-- Modal de Cadastro/Edição de Atestado -->
    <div class="modal" id="modalAtestado">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalAtestadoTitle">Cadastrar Atestado</h2>
                <button class="modal-close" onclick="fecharModal('modalAtestado')">&times;</button>
            </div>
            <form id="formAtestado">
                <input type="hidden" id="atId">
                <div class="form-group">
                    <label class="form-label">Descricao da Obra *</label>
                    <input type="text" class="form-input" id="atDescricao" required
                        placeholder="Ex: Execucao de pavimentacao asfaltica">
                </div>
                <div class="form-group">
                    <label class="form-label">Contratante</label>
                    <input type="text" class="form-input" id="atContratante"
                        placeholder="Nome do orgao/empresa contratante">
                </div>
                <div class="form-group">
                    <label class="form-label">Data de Emissao</label>
                    <input type="date" class="form-input" id="atDataEmissao">
                </div>
                <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Salvar</button>
                    <button type="button" class="btn btn-outline" onclick="fecharModal('modalAtestado')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Edição de Item de Serviço -->
    <div class="modal" id="modalEditarServico">
        <div class="modal-content modal-sm">
            <div class="modal-header">
                <h2 id="modalServicoTitle">Editar Item de Servico</h2>
                <button class="modal-close" onclick="fecharModal('modalEditarServico')">&times;</button>
            </div>
            <form id="formEditarServico" onsubmit="salvarServicoItem(event)">
                <input type="hidden" id="editServicoAtestadoId">
                <input type="hidden" id="editServicoIndex">
                <div class="form-group">
                    <label class="form-label">Item (codigo)</label>
                    <input type="text" class="form-input" id="editServicoItem"
                        placeholder="Ex: 001.03.11">
                </div>
                <div class="form-group">
                    <label class="form-label">Descricao *</label>
                    <input type="text" class="form-input" id="editServicoDescricao" required
                        placeholder="Ex: Execucao de pavimentacao asfaltica">
                </div>
                <div class="d-flex gap-2">
                    <div class="form-group" style="flex: 2;">
                        <label class="form-label">Quantidade *</label>
                        <input type="number" class="form-input" id="editServicoQuantidade" step="0.01" required
                            placeholder="1000">
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label class="form-label">Unidade *</label>
                        <input type="text" class="form-input" id="editServicoUnidade" required
                            placeholder="m2, m3...">
                    </div>
                </div>
                <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Salvar</button>
                    <button type="button" class="btn btn-outline" onclick="fecharModal('modalEditarServico')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <script src="js/config.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/app.js"></script>
    <script src="js/atestados.js"></script>
    <script>
        // Funcoes globais para compatibilidade com onclick no HTML
        function abrirModalAtestado() { AtestadosModule.abrirModalAtestado(); }
        function abrirRelatorioGeral() { AtestadosModule.abrirRelatorioGeral(); }
        function salvarServicoItem(event) { AtestadosModule.salvarServicoItem(event); }
    </script>
</body>
</html>
