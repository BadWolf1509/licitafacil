<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LicitaF치cil - Atestados</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/atestados.css">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <a href="dashboard.html" class="header-logo">LicitaF치cil</a>

        <!-- Bot칚o hamburger (mobile) -->
        <button class="nav-toggle" aria-label="Abrir menu" aria-expanded="false">
            <span class="hamburger"></span>
        </button>

        <nav class="header-nav" id="headerNav">
            <a href="dashboard.html">Dashboard</a>
            <a href="atestados.html" class="active">Atestados</a>
            <a href="analises.html">An치lises</a>
            <a href="admin.html" id="adminLink" class="hidden">Admin</a>
            <a href="perfil.html">Perfil</a>
            <a href="#" class="nav-logout">Sair</a>
        </nav>
    </header>

    <div class="container">
        <div id="alertContainer"></div>

        <div id="processingJobs" class="mb-2"></div>

        <div class="d-flex justify-between align-center mb-3">
            <h1>Meus Atestados</h1>
            <div class="d-flex gap-2">
                <button class="btn btn-outline" id="btnRelatorioGeral" style="display: none;">
                    Relatorio Geral
                </button>
                <button class="btn btn-primary" id="btnNovoAtestado">+ Novo Atestado</button>
            </div>
        </div>

        <!-- Filtro de atestados -->
        <div class="filtro-atestados" id="filtroAtestadosContainer" style="display: none;">
            <input type="text"
                   id="filtroAtestadosInput"
                   class="form-input"
                   placeholder="Filtrar atestados por descricao, contratante..."
                   >
            <span class="filtro-contador" id="atestadosFiltradosCount"></span>
        </div>

        <!-- Lista de atestados -->
        <div id="listaAtestados">
            <div class="card empty-state">
                <div class="empty-state-icon">&#128203;</div>
                <h3>Carregando atestados...</h3>
            </div>
        </div>
    </div>

    <!-- Modal de Resultado Consolidado (Individual) -->
    <div class="modal" id="modalResultado">
        <div class="modal-content modal-resultado">
            <div class="modal-header">
                <h2>Resultado Consolidado</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div id="resultadoContent">
                Carregando...
            </div>
        </div>
    </div>

    <!-- Modal de Relat칩rio Geral (Todos os Atestados) -->
    <div class="modal" id="modalRelatorioGeral">
        <div class="modal-content modal-relatorio-geral">
            <div class="modal-header">
                <h2>Relatorio Consolidado - Todos os Atestados</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div id="relatorioGeralContent">
                Carregando...
            </div>
        </div>
    </div>

    <!-- Modal de Detalhes do Servi칞o (Atestados que comp칫em) -->
    <div class="modal" id="modalDetalhesServico">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h2>Detalhes do Servico</h2>
                <button class="modal-close">&times;</button>
            </div>
            <div id="detalhesServicoContent">
                Carregando...
            </div>
        </div>
    </div>

    <!-- Modal de Cadastro/Edi칞칚o de Atestado -->
    <div class="modal" id="modalAtestado">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalAtestadoTitle">Novo Atestado</h2>
                <button class="modal-close">&times;</button>
            </div>

            <!-- Tabs do Modal -->
            <div class="modal-tabs" id="modalAtestadoTabs">
                <button class="modal-tab active" data-tab="upload">
                    游늯 Upload de Arquivo
                </button>
                <button class="modal-tab" data-tab="manual">
                    九勇 Cadastro Manual
                </button>
            </div>

            <!-- Conte칰do: Upload -->
            <div class="modal-tab-content active" id="tabUpload">
                <div class="upload-zone" id="uploadZone">
                    <div class="upload-icon">游늯</div>
                    <h3>Arraste um PDF ou imagem aqui</h3>
                    <p class="text-muted">ou clique para selecionar um arquivo</p>
                    <input type="file" id="fileInput" accept=".pdf,.png,.jpg,.jpeg">
                </div>
                <p class="text-center text-muted" style="font-size: 0.875rem; margin-top: 1rem;">
                    O sistema extrair치 automaticamente os dados do documento.
                </p>
            </div>

            <!-- Conte칰do: Cadastro Manual -->
            <div class="modal-tab-content" id="tabManual">
                <form id="formAtestado">
                    <input type="hidden" id="atId">
                    <div class="form-group">
                        <label class="form-label">Descricao da Obra *</label>
                        <input type="text" class="form-input" id="atDescricao" required
                            placeholder="Ex: Execucao de pavimentacao asfaltica">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Contratante</label>
                        <input type="text" class="form-input" id="atContratante"
                            placeholder="Nome do orgao/empresa contratante">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Data de Emissao</label>
                        <input type="date" class="form-input" id="atDataEmissao">
                    </div>
                    <div class="d-flex gap-2">
                        <button type="submit" class="btn btn-primary" style="flex: 1;">Salvar</button>
                        <button type="button" class="btn btn-outline" data-dismiss="modal">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal de Edi칞칚o de Item de Servi칞o -->
    <div class="modal" id="modalEditarServico">
        <div class="modal-content modal-sm">
            <div class="modal-header">
                <h2 id="modalServicoTitle">Editar Item de Servico</h2>
                <button class="modal-close">&times;</button>
            </div>
            <form id="formEditarServico">
                <input type="hidden" id="editServicoAtestadoId">
                <input type="hidden" id="editServicoIndex">
                <div class="form-group">
                    <label class="form-label">Item (codigo)</label>
                    <input type="text" class="form-input" id="editServicoItem"
                        placeholder="Ex: 001.03.11">
                </div>
                <div class="form-group">
                    <label class="form-label">Descricao *</label>
                    <input type="text" class="form-input" id="editServicoDescricao" required
                        placeholder="Ex: Execucao de pavimentacao asfaltica">
                </div>
                <div class="d-flex gap-2">
                    <div class="form-group" style="flex: 2;">
                        <label class="form-label">Quantidade *</label>
                        <input type="number" class="form-input" id="editServicoQuantidade" step="0.01" required
                            placeholder="1000">
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label class="form-label">Unidade *</label>
                        <input type="text" class="form-input" id="editServicoUnidade" required
                            placeholder="m2, m3...">
                    </div>
                </div>
                <div class="d-flex gap-2">
                    <button type="submit" class="btn btn-primary" style="flex: 1;">Salvar</button>
                    <button type="button" class="btn btn-outline" data-dismiss="modal">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Supabase JS (local para evitar bloqueio de tracking prevention) -->
    <script src="js/lib/supabase.min.js"></script>
    <script src="js/sanitize.js"></script>
    <script src="js/config.js"></script>
    <script src="js/realtime.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/app.js"></script>
    <script type="module" src="js/atestados/index.js"></script>
</body>
</html>
